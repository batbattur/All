name: QA 
on:
   pull_request: 
   push:
      branches:
         - master

concurrency:
   group: ${{ github.workflow }}-${{ github.head_ref || github.sha }}
   cancel-in-progress: true


jobs:
  checklist_job:
    runs-on: ubuntu-latest
    name: checklist_job
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Checkout code
        run: jq --version
        
      - name: Test output
        run: echo "QUEUE_LOCKED=true" >>$GITHUB_ENV
        
      - name: Echo QUEUE_LOCKED
        run: echo "${{ env.QUEUE_LOCKED }}"

      - name: Should run 1
        if: ! env.QUEUE_LOCKED == 'false'
        run: echo "hi"
        
      - name: Should skip 1
        if: ! env.QUEUE_LOCKED == 'true'
        run: echo "hi"
        
      - name: Test output
        run: echo "QUEUE_LOCKED=false" >>$GITHUB_ENV
        
      - name: Echo QUEUE_LOCKED
        run: echo "${{ env.QUEUE_LOCKED }}"

      - name: Should run 2
        if: ! env.QUEUE_LOCKED == 'false'
        run: echo "hi"
        
      - name: Should skip 2
        if: ! env.QUEUE_LOCKED == 'true'
        run: echo "hi"

      - name: Should run 3
        if: ! env.QUEUE_LOCKED != 'false'
        run: echo "hi"
        
      - name: Should skip 3
        if: ! env.QUEUE_LOCKED != 'true'
        run: echo "hi"
     
#       - name: Dump GitHub context
#         env:
#           GITHUB_CONTEXT: ${{ toJSON(github) }}
#         run: echo "$GITHUB_CONTEXT"

#       - name: Print TESTING
#         run: |
#            echo ${{ github.workflow  }}
#            echo ${{ github.ref }}
#            echo ${{ github.run_number }}
#         shell: bash
        
#       - name: Print github.sha 
#         run: echo ${{ github.sha }}

#       - name: Print github.event.pull_request.head.sha
#         run: echo ${{ github.event.pull_request.head.sha }}        
        
        
#       - name: Get head commit sha from the push event and set it to push_head_commit env
#         run: echo "push_head_commit=$(echo $COMMITS_JSON | jq ".[length - 2].id")" >> $GITHUB_ENV
#         shell: bash
#         env:
#             COMMITS_JSON: ${{ toJSON(github.event.commits) }}

#       - name: Print sha of the head commit
#         run: echo "$push_head_commit"
#         shell: bash
