name: Set CI Environment Variables
description: Set CI Environment Variables
runs:
   using: 'composite'
   steps:        
      # - name: Dump GitHub context
      #   env:
      #     GITHUB_CONTEXT: ${{ toJSON(github) }}
      #   run: echo "$GITHUB_CONTEXT"
      #   shell: bash

      - name: echo COMMIT
        run: echo "$COMMIT"
        shell: bash
        
      - name: RUN ATTEMPT AND NUMBER
        shell: bash
        run: |
           echo "RUN ATTEMPT: ${{ github.run_attempt }}"
           echo "RUN NUMBER: ${{ github.run_number }}"

      - name: check-attempt
        shell: bash
        id: check-attempt
        run: |
           echo "INSIDE CHECK ATTEMPT"
           echo "RUN ATTEMPT: ${{ github.run_attempt }}"
           echo "first_attempt=$(echo ${{ github.run_attempt }} == 1 | bc}" >> $GITHUB_OUTPUT

      - name: check-attempt output
        shell: bash
        run: |
           echo "CHECKING check-attempt output:" ${{ steps.check-attempt.outputs.first_attempt }}
           echo ${{ steps.check-attempt.outputs.first_attempt }}

      - name: TEST 3
        shell: bash
        if:  github.run_attempt == 1
        run: |
           echo "RUN ATTEMPT: ${{ github.run_attempt }}"
           echo "RUN NUMBER: ${{ github.run_number }}"

      - name: failure
        shell: bash
        if: ${{ steps.check-attempt.outputs.first_attempt == 'true' && failure() }}
        run: |
           echo "RUNNING THE FAILURE CASE"

      - name: alwaysaaa
        shell: bash
        if:  always()
        run: |
           echo "RUNNING THE ALWAYS CASE"
           
